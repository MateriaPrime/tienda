{% extends "base.html" %}
{% load static %}

{% block contenido %}
  <article class="product-detail">
    {# Imagen #}
    {% if producto.imagen %}
      {% if producto.imagen.name|slice:":9" == "productos" %}
        {# caso: subida a /media/productos/... #}
        <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" class="detail-img">
      {% else %}
        {# caso: viejo, con ruta tipo "images/guitarra.png" #}
        <img src="{% static producto.imagen.name %}" alt="{{ producto.nombre }}" class="detail-img">
      {% endif %}
    {% endif %}

    <h2>{{ producto.nombre }}</h2>
    <p class="price">${{ producto.precio }}</p>
    <p>{{ producto.descripcion }}</p>

    {% if producto.stock|default:0 > 0 %}
      <p><strong>Stock:</strong> {{ producto.stock }}</p>
    {% else %}
      <p style="color:red;"><strong>Sin stock</strong></p>
    {% endif %}

    {% if request.session.carrito_id %}
      <a class="btn" href="{% url 'agregar' producto_id=producto.id %}">Agregar al carrito</a>
    {% else %}
      <a class="btn" href="{% url 'nuevo_carrito' %}?next={% url 'detalle_producto' producto.id %}">
        Crear carrito y agregar
      </a>
    {% endif %}

    <a class="btn btn-outline" href="{% url 'productos' %}">Volver a productos</a>
  </article>
{% endblock %}
